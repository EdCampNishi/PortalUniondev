
@model IList<UnionDev.Models.Agendamento>
@{
    ViewBag.Title = "PainelControleAdmin";
    //Layout = "~/Views/Admin/LayoutContaAdmin.cshtml";
    Layout = "~/Views/Shared/LayoutGeralAdmin.cshtml";
}

<section>

    <h3>Consultas do Dia - <span>@DateTime.Now.ToShortDateString()</span></h3>

    <form class="form-horizontal" name="form" id="form">


        <div class="panel-body">
            <div id="no-more-tables">
                <table class="table table-striped table-bordered table-hover table-condensed cf" id="grindclientes">
                    <thead class="cf">
                        <tr>
                            <th>Candidato</th>
                            <th>Descrição</th>
                            <th>Horário</th>
                            <th>Ação</th>
                        </tr>
                    </thead>
                    <tbody>
                        @if (Model.Count != 0)
                        {
                            foreach (UnionDev.Models.Agendamento agendamento in Model)
                            {
                                <tr class="gradeU">
                                    <td data-title="Candidato">@agendamento.NomeCandidato</td>
                                    <td data-title="Descrição">@agendamento.Descricao</td>
                                    <td data-title="Horário">@agendamento.HoraInicio</td>
                                    <td data-title="Ação">
                                        <button class="btn btn-primary" onclick="Remover(@agendamento.Codigo)">Deletar</button>
                                        <button type="button" class="btn btn-primary" onclick="AbrirModal(@agendamento.Codigo)">Editar</button>
                                    </td>
                                </tr>
                            }
                        }
                    </tbody>
                </table>
            </div>
        </div>
    </form>



    <div class="modal" id="modal" name="modal" tabindex="-1" role="dialog">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Editar Agendamento</h5>
                    <button class="close" data-dismiss="modal">
                        <span>x</span>
                    </button>
                </div>
                <div class="modal-body">
                    <div class="form-group">
                        <input hidden name="idM" id="idM" />
                        <label for="candidato">Candidato</label>
                        <input type="text" class="form-control" name="candidatoM" id="candidatoM" placeholder="Nome Candidato">
                    </div>

                    <div class="form-group">
                        <label for="descricao">Descrição</label>
                        <input type="text" class="form-control" name="descricaoM" id="descricaoM" placeholder="">
                    </div>

                    <div class="form-group">
                        <label for="horario">Horário</label>
                        <input type="text" class="form-control" name="horarioM" id="horarioM" placeholder="">
                    </div>

                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-dismiss="modal">Fechar</button>
                    <button type="button" class="btn btn-primary" onclick="Editar()">Salvar mudanças</button>
                </div>
            </div>
        </div>
    </div>

</section>


<script>

    function AbrirModal(cod) {
        $('#modal').modal('show');
        $.ajax({
            url: "@Url.Action("ConsultarClientePorId", "Admin")",
            data: { id: cod },
            type: "GET",
            success: function (retorno) {
                $("#idM").val(retorno['Codigo']);
                $("#candidatoM").val(retorno['Candidato']);
                $("#descricaoM").val(retorno['Descricao']);
                $("#horarioM").val(retorno['Horario']);
            }
        })
    };


    function Editar() {
        var cod = $("#idM").val();
        var nome = $("#candidatoM").val();
        var descricao = $("#descricaoM").val();
        var horario = $("#horarioM").val();

        $.ajax({
            url: "@Url.Action("", "")",
            type: "POST",
            datatype: "json",
            data: { codigo: cod, Nome: nome, Descricao: descricao, HorarioIni: horario },
            success: function () {
                location.reload();
            }
        });
    };


</script>
